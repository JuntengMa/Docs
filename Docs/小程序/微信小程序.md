怎么开启CSP小程序架构，原理、性能优化、setdata

> **微信小程序架构包括**
>
> - 视图层： 展示小程序UI界面，由WXML和WXSS组成
> - 逻辑层： 处理小程序交互逻辑，由js编写
> - 框架层： 提供小程序运行环境，管理和协调视图层和逻辑层的交互
> - 基础库：基础库是微信提供的底层支持库，包含了小程序的运行时环境和核心功能实现。它提供了一系列的系统 API、组件库和工具函数，为开发者提供了丰富的功能和接口。
>
> **原理：**
>
> - 微信小程序的原理是基于微信客户端的webview引擎实现的。
> - 小程序在微信客户端内运行，通过 WebView 加载和渲染小程序的界面和逻辑，实现了小程序的展示和交互功能。
> - 微信客户端提供了一系列的原生 API 和功能接口，小程序可以通过这些接口与微信客户端进行通信和交互，从而实现了丰富的功能和效果，例如微信扫一扫，转发，分享，在线客服等功能。
>
> **视图层和逻辑层通信方式：**
>
> - 通过事件绑定和数据绑定机制setData。
>
> **setData做了哪些优化设计：**
>
> - **批量更新：**
>   - 微信小程序框架会对连续的 setData 调用进行合并，将多次更新合并为一次，减少了频繁的数据更新和视图渲染，提高了性能。
>   - 例如，如果在一个事件处理函数中多次调用 setData 更新数据，框架会将这些更新操作合并为一次。
> - **数据差异比对：**
>   - 在执行 setData 时，微信小程序框架会对新旧数据进行比对，只对发生变化的数据进行更新，减少了不必要的页面渲染，提高了渲染效率。
>   - 通过比对新旧数据，框架可以判断出哪些数据需要更新，哪些数据没有变化，从而避免了不必要的 DOM 操作。
> - **异步更新：**
>   - 在执行 setData 后，框架并不会立即更新页面，而是将更新操作放入微任务队列中，等待下一个微任务执行时再进行更新，这样可以避免阻塞主线程，提高了页面的响应速度和流畅度。
> - **Virtual DOM 优化：**
>   - 微信小程序框架内部采用了 Virtual DOM 技术，通过对 Virtual DOM 进行操作来实现页面更新。在进行 Virtual DOM 操作时，框架会对 DOM 结构进行优化，减少 DOM 操作次数，提高渲染性能。