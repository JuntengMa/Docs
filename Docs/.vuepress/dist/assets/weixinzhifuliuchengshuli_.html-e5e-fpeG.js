import{_ as r,r as s,o,c as l,a as c,b as e,d as t,f as a,e as i}from"./app-iph3vjA0.js";const p={},h=e("br",null,null,-1),g={href:"https://pay.weixin.qq.com/wiki/doc/apiv3/open/pay/chapter2_3.shtml",target:"_blank",rel:"noopener noreferrer"},_=e("br",null,null,-1),d=e("strong",null,"两个模块三种情况",-1),m=e("strong",null,"h5 支付（浏览器支付，微信浏览器支付）和小程序支付",-1),u=e("strong",null,"（",-1),b={href:"https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=7_4",target:"_blank",rel:"noopener noreferrer"},f=e("strong",null,[t("）😁，"),e("strong",null,"文档看起来虽然很复杂但是仔细看还是看的明白的，其实主要流程微信已经帮忙总结好了，大概就下面这几个流程"),t("：")],-1),w=e("br",null,null,-1),y=e("p",null,[e("strong",null,"商户系统和微信支付系统主要交互：")],-1),k={href:"https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=9_1",target:"_blank",rel:"noopener noreferrer"},q=e("strong",null,"下单",-1),x=e("br",null,null,-1),O={href:"https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=7_7&index=6",target:"_blank",rel:"noopener noreferrer"},v=e("strong",null,"支付",-1),j=e("br",null,null,-1),I={href:"https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=9_7",target:"_blank",rel:"noopener noreferrer"},A=e("strong",null,"修改订单支付状态（主要是后端的事儿）",-1),S=e("br",null,null,-1),N={href:"https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=9_2",target:"_blank",rel:"noopener noreferrer"},P=e("p",null,[t("具体是怎么实现的呢？**"),e("br"),t(" 关于微信支付的一些资料的准备和账号申请配置不做过多赘述，详情仔细翻阅官方文档即可")],-1),V={href:"https://pay.weixin.qq.com/wiki/doc/apiv3/open/pay/chapter2_6_1.shtml",target:"_blank",rel:"noopener noreferrer"},D={href:"https://pay.weixin.qq.com/wiki/doc/apiv3/open/pay/chapter2_6_2.shtml",target:"_blank",rel:"noopener noreferrer"},E=e("p",null,[e("a",{name:"5wZ9E"})],-1),B={id:"一、h5-支付流程-浏览器支付注意第三步",tabindex:"-1"},H=e("a",{class:"header-anchor",href:"#一、h5-支付流程-浏览器支付注意第三步","aria-hidden":"true"},"#",-1),J={href:"https://pay.weixin.qq.com/wiki/doc/api/H5.php?chapter=15_4",target:"_blank",rel:"noopener noreferrer"},z=i('<p><img src="https://raw.githubusercontent.com/tengyuanOasis/image/master/1614670559923-a851ec36-dcd3-41c6-a22a-3ff3a913e9ef.png" alt="image.png"><br>具体的业务实现：</p><ol><li><strong>前端调用接口创建订单，生成订单 id</strong><br><img src="https://raw.githubusercontent.com/tengyuanOasis/image/master/1614670725497-46d096ec-671f-4fcf-b72c-a6851daf5524.png" alt="image.png"></li><li>获取到订单 id 之后，调用微信支付接口（这里的微信支付是由后端发起的，前端仅传参数给后端，参数如下图，订单 ID，金额，支付状态等等）<br><img src="https://raw.githubusercontent.com/tengyuanOasis/image/master/1614670909687-c49c2a25-ccb0-45be-97d9-1a50f83d3e90.png" alt="image.png"></li><li>后端发起请求，获取<strong>mweb_url</strong>，**前端重定向到该地址，并唤起微信支付，发起微信支付流程     **</li></ol><p><img src="https://raw.githubusercontent.com/tengyuanOasis/image/0b2bbe4b0ef19a002cf0b564f581dae701106d64/1614673719886-ba692c90-45d6-4f5b-93ea-afaf94ba9d45.png" alt=""></p><p><img src="https://raw.githubusercontent.com/tengyuanOasis/image/master/1614671482174-9b5e4abd-67b3-4067-a8d2-1d14d553901c.gif" alt=""></p><ol start="4"><li>支付完成（取消支付）<br>支付完成后，后端会受到微信给到的回调，修改数据库支付状态，流程结束<br>若用户取消支付，订单状态则一直为未支付状态，不做改变<br><img src="https://cdn.nlark.com/yuque/0/2021/png/1451656/1614673343470-49c6fe04-a164-4c48-ab48-66b83b1bbbd6.png" alt="image.png"></li><li>代码实现： <ol><li>创建订单，触发微信支付</li></ol></li></ol><p><img src="https://raw.githubusercontent.com/tengyuanOasis/image/master/1614673343470-49c6fe04-a164-4c48-ab48-66b83b1bbbd6.png" alt="image.png"></p><ol><li>调用支付接口</li></ol><p><img src="https://raw.githubusercontent.com/tengyuanOasis/image/master/1614673447779-592027e5-5ef6-4b7e-a2f0-9042bab1796e.png" alt="image.png"><a name="pDH1h"></a></p><h3 id="二、微信浏览器支付" tabindex="-1"><a class="header-anchor" href="#二、微信浏览器支付" aria-hidden="true">#</a> 二、微信浏览器支付</h3>',9),C=e("br",null,null,-1),K={href:"https://pay.weixin.qq.com/wiki/doc/api/jsapi_sl.php?chapter=7_7&index=6",target:"_blank",rel:"noopener noreferrer"},L=e("br",null,null,-1),T=e("img",{src:"https://raw.githubusercontent.com/tengyuanOasis/image/master/1614674039500-947921e3-d490-4e8e-8da5-42aa9da50c0c.png",alt:"image.png"},null,-1),W=e("br",null,null,-1),Y={href:"https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html#62",target:"_blank",rel:"noopener noreferrer"},Z=e("br",null,null,-1),F=e("strong",null,"代码实现：",-1),G=i('<ol><li><strong>生成订单</strong></li></ol><p><img src="https://raw.githubusercontent.com/tengyuanOasis/image/master/1614674554968-7a415580-3d00-4406-8491-934fb9cf3542.png" alt="image.png"></p><ol><li><strong>获取配置信息</strong></li></ol><p><img src="https://raw.githubusercontent.com/tengyuanOasis/image/master/1614674590044-7c3a4730-9016-4f0f-8424-069e317fbeb5.png" alt="image.png"></p><ol><li><strong>唤起支付</strong></li></ol><p><img src="https://raw.githubusercontent.com/tengyuanOasis/image/master/1614674788385-95c74bc2-950a-451b-8514-297373e984e4.png" alt="image.png"><br></p><p><a name="lY65a"></a></p><h3 id="三、小程序支付" tabindex="-1"><a class="header-anchor" href="#三、小程序支付" aria-hidden="true">#</a> 三、小程序支付</h3><p>小程序支付流程与上述流程基本一样，操作上更为简单一些，微信对于自家产品兼容还是相当 nice 的~<br>直接看代码即可</p><ol><li>生成订单<br><img src="https://raw.githubusercontent.com/tengyuanOasis/image/master/1614675088664-e641c675-fa68-4529-9401-77e12e996b8e.png" alt="image.png"></li><li>获取支付配置项</li></ol><p><img src="https://raw.githubusercontent.com/tengyuanOasis/image/master/1614675158521-5fa7d053-a489-41dc-8b28-f16ae0cc7180.png" alt="image.png"></p><ol start="3"><li>唤起支付，支付完成后进行对应操作<br><img src="https://cdn.nlark.com/yuque/0/2021/png/1451656/1614675196376-35245360-481c-4007-a48b-6b4ae3ad9290.png" alt="image.png"></li></ol>',12);function M(Q,R){const n=s("ExternalLinkIcon");return o(),l("div",null,[c(" @format "),e("p",null,[t("较为常用（小程序， h5），这里总结一篇文档方便后项目维护~~~"),h,t("关于微信支付的东西，微信的"),e("a",g,[t("官方文档"),a(n)]),t("已经写得很明白了，这里只是针对项目做一个简单的说明和总结。"),_,t("好慧赔项目中用到的支付，主要涉及"),d,t("，"),m,t("，相对来说小程序支付实操起来会更简单一些，h5 支付因为在非微信环境下，故需要引入微信提供的 jssdk 脚本让 h5 项目也可以调用一些微信的开放 api（其中就包含了微信支付等功能）。")]),e("p",null,[t("那么问题来了，微信支付什么流程，怎么实现的？上文档！"),u,e("a",b,[t("https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=7_4"),a(n)]),f,w]),y,e("p",null,[t("1、商户 server 调用统一下单接口请求订单，api 参见公共 api【"),e("a",k,[t("统一下单 API"),a(n)]),t("】----》"),q,x,t("2、商户 server 可通过【"),e("a",O,[t("JSAPI 调起支付 API"),a(n)]),t("】调起微信支付，发起支付请求。-----》"),v,j,t("3、商户 server 接收支付通知，api 参见公共 api【"),e("a",I,[t("支付结果通知 API"),a(n)]),t("】--------------》"),A,S,t("4、商户 server 查询支付结果，api 参见公共 api【"),e("a",N,[t("查询订单 API"),a(n)]),t("】 ------------------》 **订单查询")]),P,e("ul",null,[e("li",null,[t("前期准备："),e("a",V,[t("https://pay.weixin.qq.com/wiki/doc/apiv3/open/pay/chapter2_6_1.shtml"),a(n)])]),e("li",null,[t("开发文档："),e("a",D,[t("https://pay.weixin.qq.com/wiki/doc/apiv3/open/pay/chapter2_6_2.shtml"),a(n)])])]),E,e("h3",B,[H,t(" 一、H5 支付流程（"),e("a",J,[t("浏览器支付"),a(n)]),t("注意第三步）：")]),z,e("p",null,[C,t("微信开放了"),e("a",K,[t("jssdk 脚本"),a(n)]),t("，前端项目引入之后，即可使用微信的一些开放能力，如微信分享，支付，文件上传等功能，详见 h5 项目 utils/wechat/wechat.util.js 文件 ， 核心代码如下："),L,T,W,t("如图所见，想要使用 JS-SDK 唤起微信支付必须先注入配置信息，这些配置信息由后端通过"),e("a",Y,[t("签名算法"),a(n)]),t("来生成，如果参数都没问题的话则唤起微信支付，支付完成之后的流程与浏览器支付相同（支付成功微信给到回调给后端修改订单状态)"),Z,F]),G])}const X=r(p,[["render",M],["__file","weixinzhifuliuchengshuli_.html.vue"]]);export{X as default};
