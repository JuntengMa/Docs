---
  title: 一段js代码在浏览器中是如何执行的
  date: 2020-11-02
  coverWidth: 1200
  coverHeight: 750
  categories: JavaScript
  tags: JavaScript
  cover: https://drscdn.500px.org/photo/146543971/h%3D1080_k%3D1/v2?sig=9327a36e10963e5a969fb06c8544b8d1e302d1dc8e2c9512188c4ac860355498
---
 ### 一段js代码在浏览器中是如何执行的?

>	在了解代码执行流程之前 , 我们需要知道一点前置知识 , 
>	-	js解析顺序
>	-  可执行代码
>	- 执行上下文栈
>	当我们这些前置知识都捋清楚了 , js执行流程也就清楚了.....
  <!--more-->


  ### 01 / JS代码执行顺序是什么

  JavaScript代码是逐行执行的 , 但是js引擎并非一行一行的**解析**执行程序,而是一段一段的分析执行,为什么是分段执行的呢?又按什么规则来分段的呢?这里我们需要再了解一下什么是**可执行代码**

  (Js代码是逐行执行的,但是js引擎并非逐行解析程序执行的,而是判断是否可执行代码一段一段的执行的)

  ### 02 / 可执行代码 & 执行上下文

  可执行代码有三种,全局代码,函数代码,eval代码,当执行到可执行代码的时候,就会进行准备一些工作 . 这个准备工作就是**执行上下文**

  - 全局代码
  - 函数代码
  - eval代码( evla()函数可以将传入的字符串当做 JavaScript 代码进行执行 )

  ### 05 / 执行上下文栈

  为了管理js中大量的可执行上下文,JavaScript引擎创建了**执行上下文栈**来管理可执行上下文

  - 当 JavaScript 开始要解释执行代码的时候，最先遇到的就是全局代码，所以初始化的时候首先就会向执行上下文栈(ECStack)压入一个全局执行上下文，我们用 globalContext 表示它，并且只有当整个应用程序结束的时候，ECStack 才会被清空，所以程序结束之前， ECStack 最底部永远有个 globalContext.

    ```
    const ECStack  = [	
      globalContext 
    ]
    ```



  - 当函数开始执行的时候,同样生成一个可以执行上下文并压入可执行上下文栈,当函数执行完毕的时候,再从执行上下文栈中弹出

    ```
    const ECStack  = [
      eval()
      function()
      globalContext 
    ]
    ```


  ### 06 / 总结:
  - 在执行一段代码时，JS 引擎会首先**创建一个执行栈**,然后JS引擎会创建一个**全局执行上下文**，并push到执行栈中


  - 这个过程JS引擎会为这段代码中**所有变量**分配内存并赋一个初始值（undefined）


  - 在创建完成后，JS引擎会进入**执行阶段**，这个**过程JS引擎会逐行的执行代码**，即为之前分配好内存的变量逐个赋值(真实值)。


  - 如果这段代码中存在function的声明和调用，那么JS引擎会创建一个**函数执行上下文**，并push到执行栈中，其创建和执行过程跟全局执行上下文一样。但有特殊情况，即当函数中存在对其它函数的调用时，JS引擎会在父函数执行的过程中，将子函数的全局执行上下文push到执行栈，这也是为什么子函数能够访问到父函数内所声明的变量。


  - 还有一种特殊情况是，在子函数执行的过程中，父函数已经return了，这种情况下，JS引擎会将父函数的上下文从执行栈中移除，与此同时，JS引擎会为还在执行的子函数上下文创建一个闭包，这个闭包里保存了父函数内声明的变量及其赋值，子函数仍然能够在其上下文中访问并使用这边变量/常量。当子函数执行完毕，JS引擎才会将子函数的上下文及闭包一并从执行栈中移除。

  ### JS引擎如何处理高并发?

  **JS引擎是单线程的**，那么它是如何处理高并发的呢？即当代码中存在异步调用时JS是如何执行的?

  比如setTimeout或fetch请求都是non-blocking的，
  当异步调用代码触发时，JS引擎会将需要异步执行的代码移出调用栈，直到等待到返回结果，JS引擎会立即将与之对应的回调函数push进任务队列中等待被调用，
  当调用(执行)栈中已经没有需要被执行的代码时，JS引擎会立刻将任务队列中的回调函数逐个push进调用栈并执行。这个过程我们也称之为**事件循环**。
