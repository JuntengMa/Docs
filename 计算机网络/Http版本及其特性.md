---
cover: https://images.unsplash.com/photo-1593642634443-44adaa06623a?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=2125&q=80
coverWidth: 1200
coverHeight: 750
title: Http各版本特性及其区别
categories: Http&Https
tags: Http
top:
permalink:
---

### HTTP各版本特性及区别

<!--more-->


本文参考: 
https://juejin.im/post/6844903923136856078
https://segmentfault.com/a/1190000019891825


HTTP 是基于 TCP/IP 协议的一个应用层协议，是现代互联网的一个基础协议。规定了客户端与服务端之间的通信格式以及所占用的服务端口80(HTTPS是443)。

### 版本

HTTP 协议从开始立项到现在一共经历了 4 个版本:

```
HTTP 0.9 -> HTTP 1.0 -> HTTP 1.1 -> HTTP 2
```



#### HTTP 0.9

HTTP 0.9 是一个最古老的版本

**只支持GET请求方式**：由于不支持其他请求方式，因此客户端是没办法向服务端传输太多的信息
没有请求头概念：所以不能在请求中指定版本号，**服务端也只具有返回 HTML字符串的能力**
**服务端相响应之后，立即关闭TCP连接**

#### HTTP 1.0

随着 HTTP 1.0 的发布，这个版本:

请求方式**新增了POST，DELETE，PUT，HEADER等方式**
增添了**请求头**和**响应头**的概念，在通信中指定了 HTTP 协议版本号，以及其他的一些元信息 (比如: 状态码、权限、缓存、内容编码)
扩充了传输内容格式，图片、音视频资源、二进制等都可以进行传输
在这个版本主要的就是对请求和响应的元信息进行了扩展，客户端和服务端有更多的获取当前请求的所有信息，进而更好更快的处理请求相关内容。

##### 请求头

一个简单请求的头信息

```
GET / HTTP/1.0
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5)
Accept: */*
```
浏览器控制台reponse headers
![](https://s1.ax1x.com/2020/10/30/BtJAlF.png)

可以看到在请求方法之后有 请求资源的位置 + 请求协议版本，之后是一些客户端的信息配置

##### 响应头

一个简单响应的头信息(v1.0)

```
HTTP/1.0 200 OK
Content-Type: text/plain
Content-Length: 137582
Expires: Thu, 05 Dec 1997 16:00:00 GMT
Last-Modified: Wed, 5 August 1996 15:55:28 GMT
// 这是一个空行
...数据内容
```
浏览器控制台request headers
![](https://s1.ax1x.com/2020/10/30/BtJfhV.png)

服务端的响应头第一个就是 请求协议版本，后面紧跟着是这次请求的状态码、以及状态码的描述，之后的内容是一些关于返回内容的描述。

##### Content-Type

在 HTTP 1.0 的时候，任何的资源都可以被传输，传输的格式呢也是多种多样的，客户端在收到响应体的内容的时候就是根据这个 Content-Type 去进行解析的。所以**服务端返回时候**必须带着这个字段。
![](https://s1.ax1x.com/2020/10/30/BtYKBj.png)
一些常见的 Content-Type 可以参考 对照表。 这些 Content-Type 有一个总称叫做[MIME type](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types)

##### 特性

- 无状态：服务器不跟踪不记录请求过的状态
- **无连接**：**HTTP1.0规定浏览器和服务器保持短暂的连接，浏览器的每次请求都需要与服务器建立一个TCP连接，服务器处理完成后立即断开TCP连接（无连接）**

###### 无状态 

对于无状态的特性可以借助cookie/session机制来做身份认证和状态记录

###### 无连接

无连接导致的性能缺陷有两种：

- **无法复用连接**
  每次发送请求，都需要进行一次tcp连接（即3次握手4次挥手），使得网络的利用率非常低
- **队头阻塞**
  HTTP 1.0 规定在前一个请求响应到达之后下一个请求才能发送，如果前一个阻塞，后面的请求也给阻塞的
  
#### HTTP 1.1

  HTTP 1.1 是在 1.0 发布之后的半年就推出了，完善了 1.0 版本。目前也还有很多的互联网项目基于 HTTP 1.1 在向外提供服务。

##### 特性

长连接：新增Connection字段，可以设置keep-alive值保持连接不断开
管道化：基于上面长连接的基础，管道化可以不等第一个请求响应继续发送后面的请求，但响应的顺序还是按照请求的顺序返回
缓存处理：新增字段cache-control
断点传输

###### 长连接

HTTP 1.1默认保持长连接，数据传输完成保持tcp连接不断开,继续用这个通道传输数据.

B站首页，就有keep-alive，因为他们也有IM的成分在里面。需要大量复用TCP连接～
![](https://s1.ax1x.com/2020/10/30/Btt4L4.png)

###### 管道化

基于长连接的基础，我们先看没有管道化请求响应：

tcp没有断开，用的同一个通道

```
--> 请求1 > 响应1 
--> 请求2 > 响应2 
--> 请求3 > 响应3
```

管道化的请求响应：

```
--> 请求1 --> 请求2 --> 请求3 

--> 响应1 --> 响应2 --> 响应3
```


即使服务器先准备好响应2,也是按照请求顺序先返回响应1

虽然管道化，可以一次发送多个请求，但是响应仍是顺序返回，仍然无法解决队头阻塞的问题

###### 缓存处理:
当浏览器请求资源时，先看是否有缓存的资源，如果有缓存，直接取，不会再发请求，如果没有缓存，则发送请求。 通过设置字段cache-control来控制缓存。

**怎么解决解决队头阻塞的问题?**
> 实际上，现阶段的浏览器厂商采取了另外一种做法，它允许我们打开多个TCP的会话。
> 也就是说，上图我们看到的并行，其实是不同的TCP连接上的HTTP请求和响应。这也就是我们所熟悉的浏览器对同域下并行加载6~8个资源的限制。而这，才是真正的并行！

**浏览器同域名请求的最大并发数限制**

> 当我们在浏览网页的时候，对浏览速度有一个重要的影响因素，就是浏览器的并发数量。并发数量简单通俗的讲就是，当浏览器网页的时候同时工作的进行数量。

- HTTP客户端一般对同一个服务器的并发连接个数都是有限制的。
  实际上，浏览器确实使用并行连接，但它们将并行连接的总数限制为少量（**通常为四个**）。服务器可以自由地关闭来自特定客户端的过多连接。

-  一些主流浏览器对HTTP 1.1和HTTP 1.0的最大并发连接数目，可以参考如下表格：

![](https://s1.ax1x.com/2020/10/30/BtcGjA.png)


###### 断点传输

在上传/下载资源时，如果资源过大，将其分割为多个部分，分别上传/下载，如果遇到网络故障，可以从已经上传/下载好的地方继续请求，不用从头开始，提高效率

##### Http 1.1的致命缺点：
1.明文传输
2.其实还是没有解决无状态连接的
3.当有多个请求同时被挂起的时候,就会拥塞请求通道，导致后面请求无法发送
4.臃肿的消息首部:HTTP/1.1能压缩请求内容,但是消息首部不能压缩;在现今请求中,消息首部占请求绝大部分(甚至是全部)也较为常见.

#### HTTP 2

##### 特性:

###### 二进制帧封装:

HTTP 1.x 的解析是基于文本，HTTP 2之后将所有传输的信息分割为更小的消息和帧，并对它们采用二进制格式的编码，提高传输效率

###### 多路复用:

> 所有的请求都是通过一个 TCP 连接并发完成。
> HTTP/1.x 虽然通过 pipeline 也能并发请求，但是多个请求之间的响应会被阻塞的，所以 pipeline 至今也没有被普及应用，而 HTTP/2 做到了真正的并发请求。
>
> 同时，流还支持优先级和流量控制。当流并发时，就会涉及到流的优先级和依赖。
>
> 即：HTTP2.0对于同一域名下所有请求都是基于流的，不管对于同一域名访问多少文件，也只建立一路连接。优先级高的流会被优先发送。图片请求的优先级要低于 CSS 和 SCRIPT，这个设计可以确保重要的东西可以被优先加载完

###### 头部压缩:

由于 HTTP 是无状态的，每一个请求都需要头部信息标识这次请求相关信息，所以会造成传输很多重复的信息，当请求数量增大的时候，消耗的资源就会慢慢积累上去。所以 HTTP 2 可以维护一个头部信息字典，差量进行更新头信息，减少头部信息传输占用的资源，


HTTPS 和 HTTP

- HTTPS 协议需要申请证书
- HTTP 和 HTTPS 使用端口不一样，前者是80，后者是443
- HTTP 协议运行在 TCP 之上，所有传输的内容都是明文，HTTPS 运行在 SSL/TLS 之上，SSL/TLS运行在TCP之上，所有传输的内容都经过加密的
- HTTPS 可以有效的防止运营商劫持

